<script src="data.js"></script>
    <script src="script.js"></script>

    <script>
        let currentCaptcha = "";
        const brandColors = ['#d7c4b7', '#1a1a1a', '#4285F4', '#EA4335'];

        // 1. 太陽自動旋轉 (保持在 HTML 內或移至 script.js 均可)
        function initSunRotation() {
            const sun = document.querySelector('.sun-svg');
            if (!sun) return;
            let autoRotation = 0;
            function animate() {
                autoRotation += 0.4;
                const scrollRotate = parseFloat(sun.style.getPropertyValue('--scroll-rotate')) || 0;
                sun.style.transform = `rotate(${autoRotation + scrollRotate}deg)`;
                requestAnimationFrame(animate);
            }
            animate();
        }

        // 2. 驗證碼與跳窗
        function generateCaptcha() {
            const chars = "0123456789";
            let result = "";
            for (let i = 0; i < 4; i++) result += chars.charAt(Math.floor(Math.random() * chars.length));
            currentCaptcha = result;
            const display = document.getElementById('captchaDisplay');
            if (display) {
                display.innerText = result;
                display.style.color = brandColors[Math.floor(Math.random() * brandColors.length)];
            }
        }

        function showModal(title, text) {
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalText').innerText = text;
            document.getElementById('infoModal').classList.add('active');
        }
        function closeModal() { document.getElementById('infoModal').classList.remove('active'); }

        // 3. 表單提交邏輯
        document.addEventListener('DOMContentLoaded', () => {
            initSunRotation();
            generateCaptcha();

            const contactForm = document.getElementById('contactForm');
            if (contactForm) {
                contactForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    let hasError = false;
                    document.querySelectorAll('.form-group').forEach(el => el.classList.remove('error'));

                    const name = this.querySelector('[name="name"]');
                    const email = this.querySelector('[name="email"]');
                    const message = this.querySelector('[name="message"]');
                    const captchaInput = document.getElementById('captchaInput');

                    if (!name.value.trim()) { name.parentElement.classList.add('error'); hasError = true; }
                    if (!email.value.includes('@')) { email.parentElement.classList.add('error'); hasError = true; }
                    if (!message.value.trim()) { message.parentElement.classList.add('error'); hasError = true; }
                    if (captchaInput.value !== currentCaptcha) {
                        captchaInput.closest('.form-group').classList.add('error');
                        hasError = true;
                    }

                    if (hasError) return;

                    const submitBtn = document.getElementById('submitBtn');
                    const btnSpan = submitBtn.querySelector('span');
                    const originalText = btnSpan.innerText;
                    btnSpan.innerText = "SENDING...";
                    submitBtn.disabled = true;

                    try {
                        const response = await fetch(this.action, {
                            method: 'POST',
                            body: new FormData(this),
                            headers: { 'Accept': 'application/json' }
                        });
                        if (response.ok) {
                            showModal("Sent Successfully", "您的訊息已成功送出。");
                            this.reset();
                            generateCaptcha();
                        } else {
                            showModal("Error", "發送失敗。");
                        }
                    } catch (error) {
                        showModal("Error", "網路連線異常。");
                    } finally {
                        btnSpan.innerText = originalText;
                        submitBtn.disabled = false;
                    }
                });
            }
        });
    </script>
</body>
</html>
